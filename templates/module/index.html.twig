{% extends 'base.html.twig' %}

{% block title %}Modules
{% endblock %}

{% block breadcrumb %}
	<twig:BreadcrumbItem label="Modules"/>
{% endblock %}

{% block body %}
	<div class="flex-1 p-8 bg-white">

		<div class="flex justify-between items-center mb-8">
			<h1 class="text-3xl font-medium text-[#2C416E]">Modules</h1>
		</div>

		<div class="space-y-8">
			{% for blockData in modulesByBlock %}
				{% set block = blockData.block %}
				{% set modules = blockData.modules %}

				<div class="mb-8">

					<div class="mb-4">
						<h2 class="text-xl font-semibold text-amber-500">
							{{ block.code }}
							:
							{{ block.name }}
							{% if block.hoursCount %}
								({{ block.hoursCount }}h)
							{% endif %}
						</h2>
					</div>

					<div class="bg-white rounded-lg border border-gray-200 overflow-hidden mb-4">
						<div>
							{% for module in modules %}
								<li data-module-id="{{ module.id }}" data-controller="module">

									{% if module.modulesChildren|length > 0 %}
										<div
											class="flex items-center justify-between py-3 px-6 border border-gray-200 hover:bg-gray-50 cursor-pointer" data-action="click->module#toggle">
											{# click = event, module = nom du controler, toggle = nom de la fonction #}
											<div class="flex items-center space-x-3">
												<svg
													class="w-4 h-4 text-gray-400 transition-transform duration-200 chevron" id="chevron-{{ module.id }}" data-module-target="chevron" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													{# data-module-target="chevron"== reference aux elements HTML #}
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
												<span class="text-gray-800 text-sm font-medium">
													{{ module.name }}
													{% if module.hoursCount %}
														({{ module.hoursCount }}h)
													{% endif %}
												</span>
											</div>
											<button class="text-gray-400 hover:text-gray-600" onclick="event.stopPropagation()">
												<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
											</button>
										</div>
									{% else %}
										<a href=" {{ path('app_module_edit', {'id': module.id} ) }}" class="flex items-center justify-between py-3 px-6 border border-gray-200 hover:bg-gray-50 cursor-pointer">
											<div class="flex items-center space-x-3">
												<span class="w-4 h-4"></span>
												<span class="text-gray-800 text-sm font-medium">
													{{ module.name }}
													{% if module.hoursCount %}
														({{ module.hoursCount }}h)
													{% endif %}
												</span>
											</div>
											<div class="text-gray-400 hover:text-gray-600">
												<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
											</div>
										</a>
									{% endif %}

									<ul
										class="bg-gray-50 border-t border-gray-100 hidden" id="children-{{ module.id }}" data-module-target="children">
										{# data-module-target="children" == reference aux elements HMTL #}
										{% for child in module.modulesChildren %}
											<li class="hover:bg-gray-100">
												<a href=" {{ path('app_module_edit', {'id': child.id} ) }}" class="flex items-center justify-between py-3 px-6 pl-16 group">
													<div class="flex items-center space-x-3">
														<span class="w-3 h-3"></span>
														<span class="text-gray-600 text-sm">
															{{ child.name }}
															{% if child.hoursCount %}
																({{ child.hoursCount }}h)
															{% endif %}
														</span>
													</div>
													<div class="text-gray-400 group-hover:text-gray-600">
														<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
														</svg>
													</div>
												</a>
											</li>
										{% endfor %}
									</ul>
								</li>
							{% endfor %}
						</div>
					</div>
					<twig:Button variant="blue" label="Ajouter un module" href="{{ path('app_module_add', {'id': block.id} ) }}"/>
				</div>
			{% endfor %}
		</div>

	</div>

{% endblock %}
