{% extends 'base.html.twig' %}

{% block title %}Modules
{% endblock %}

{% block breadcrumb %}
	<twig:BreadcrumbItem label="Modules"/>
{% endblock %}

{% block body %}
	<div
		class="flex-1 p-8 bg-white">

		{# Header #}
		<div class="flex justify-between items-center mb-8">
			<h1 class="text-2xl font-bold text-gray-800">Modules</h1>
		</div>

		{# Teaching Blocks avec modules #}
		<div class="space-y-8">
			{% for blockData in modulesByBlock %}
				{% set block = blockData.block %}
				{% set modules = blockData.modules %}

				<div
					class="mb-8">
					{# Teaching block header #}
					<div class="mb-4">
						<h2 class="text-xl font-semibold text-amber-500">
							{{ block.code }}
							:
							{{ block.name }}
							{% if block.hoursCount %}
								({{ block.hoursCount }}h)
							{% endif %}
						</h2>
					</div>

					{# Modules liste pour les block #}
					<div class="bg-white rounded-lg border border-gray-200 overflow-hidden mb-4">
						<divs>
							{% for module in modules %}
								{# Module Parent #}
								<li class=" data-module-id=" {{ module.id }} ">
									{% if module.modulesChildren|length > 0 %}
										<div class="flex items-center justify-between py-3 px-6 border border-gray-200 hover:bg-gray-50 cursor-pointer" onclick="toggleModule({{ module.id }})">
											<div class="flex items-center space-x-3">
												<svg class="w-4 h-4 text-gray-400 transition-transform duration-200 chevron" id="chevron-{{ module.id }}" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
												<span class="text-gray-800 text-sm font-medium">
													{{ module.name }}
													{% if module.hoursCount %}
														({{ module.hoursCount }}h)
													{% endif %}
												</span>
											</div>
											<button class="text-gray-400 hover:text-gray-600" onclick="event.stopPropagation()">
												<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
											</button>
										</div>
									{% else %}
										{# a voir pour comment on fait les id pour les edtis #}
										<a href=" {{ path('app_module_edit', {'id': module.id} ) }}" class="flex items-center justify-between py-3 px-6 border border-gray-200 hover:bg-gray-50 cursor-pointer">
											<div class="flex items-center space-x-3">
												<span class="w-4 h-4"></span>
												<span class="text-gray-800 text-sm font-medium">
													{{ module.name }}
													{% if module.hoursCount %}
														({{ module.hoursCount }}h)
													{% endif %}
												</span>
											</div>
											<div class="text-gray-400 hover:text-gray-600">
												<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
												</svg>
											</div>
										</a>
									{% endif %}

									{# Module enfant #}
									<ul class="bg-gray-50 border-t border-gray-100 hidden" id="children-{{ module.id }}">
										{% for child in module.modulesChildren %}
											<li class="hover:bg-gray-100">
												<a href=" {{ path('app_module_edit', {'id': child.id} ) }}" class="flex items-center justify-between py-3 px-6 pl-16 group">
													<div class="flex items-center space-x-3">
														<span class="w-3 h-3"></span>
														<span class="text-gray-600 text-sm">
															{{ child.name }}
															{% if child.hoursCount %}
																({{ child.hoursCount }}h)
															{% endif %}
														</span>
													</div>
													<div class="text-gray-400 group-hover:text-gray-600">
														<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
														</svg>
													</div>
												</a>
											</li>
										{% endfor %}
									</ul>
								</li>
							{% endfor %}
						</divs>
					</div>

					<twig:Button variant="blue" label="Ajouter un module" href="#"/>
				</div>
			{% endfor %}
		</div>

	</div>


	{# JavaScript#}
	<script>
		function toggleModule(moduleId) {
const childrenElement = document.getElementById("children-" + moduleId,);
const chevronElement = document.getElementById("chevron-" + moduleId,);

if (childrenElement) {
const isHidden = childrenElement.classList.contains("hidden");

if (isHidden) { // Show children
childrenElement.classList.remove("hidden");
// Rotate chevron down
chevronElement.style.transform = "rotate(90deg)";
} else { // Hide children
childrenElement.classList.add("hidden");
// Rotate chevron back
chevronElement.style.transform = "rotate(0deg)";
}
}
}
	</script>
{% endblock %}
